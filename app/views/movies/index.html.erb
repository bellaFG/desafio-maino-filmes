<div class="index-header">
  <h2><%= t('movies.index.title') %></h2>
  <div class="filter-toggle-container">
    <button id="toggle-filter" class="btn btn--filter"><%= t('movies.index.filter') %> â–¾</button>
  </div>
</div>

<div id="filter-panel" class="filter-panel">
  <%= form_with url: movies_path, method: :get, local: true, class: "filter-form" do |f| %>
    <div class="form-row">
      <div class="form-group">
        <%= f.label :year, t('movies.index.filters.year') %>
        <%= f.number_field :year, value: params[:year], class: "form-control" %>
      </div>

      <div class="form-group">
        <%= f.label :director, t('movies.index.filters.director') %>
        <%= f.text_field :director, value: params[:director], class: "form-control" %>
      </div>

      <div class="form-group">
        <%= f.label :categories, t('movies.index.filters.categories') %>
        <%= f.text_field :categories, value: params[:categories], class: "form-control" %>
      </div>

      <div class="form-group">
        <button type="submit" class="btn btn--filter">
          <%= t('movies.index.filters.apply') %>
        </button>
      </div>
    </div>
  <% end %>
</div>

<% if user_signed_in? %>
  <div class="actions-bar">
    <%= link_to t('movies.index.add_new'), new_movie_path, class: "btn btn--primary" %>
    <%= link_to t('movies.index.add_new_import'), new_import_path, class: "btn btn--primary" %>
  </div>
<% end %>

<div class="movies-grid">
  <% @movies.each do |movie| %>
    <div class="movie-card">
      <h3 class="movie-card__title">
        <%= link_to movie.title, movie_path(movie), class: "movie-link" %>
      </h3>

      <% if movie.poster.attached? %>
        <div class="poster">
          <%= image_tag poster_variant(movie.poster), class: "poster-img" %>
        </div>
      <% end %>

      <p>
        <strong><%= t('movies.index.director') %>:</strong> <%= movie.director %> |
        <strong><%= t('movies.index.year') %>:</strong> <%= movie.year %>
      </p>

      <p><%= truncate(movie.synopsis, length: 150) %></p>

      <p>
        <strong><%= t('movies.index.categories') %>:</strong>
        <%= movie.categories.map(&:name).join(", ") %>
      </p>

      <div class="tags">
        <p>
          <strong><%= t('movies.show.tags') %>:</strong>
          <% if movie.tags.any? %>
            <% movie.tags.each do |tag| %>
              <span class="tag"><%= tag.name %></span>
            <% end %>
          <% else %>
            <span class="tag tag--empty"><%= t('movies.show.no_tags') %></span>
          <% end %>
        </p>
      </div>

      <div class="actions">
        <% if user_signed_in? && movie.user == current_user %>
          <%= link_to t('movies.index.edit'), edit_movie_path(movie), class: "btn btn--secondary" %>
          <%= button_to t('movies.index.delete'), movie_path(movie), method: :delete, data: { confirm: t('movies.index.confirm_delete') }, class: "btn btn--danger" %>
        <% end %>
        <%= link_to t('movies.index.view_details'), movie_path(movie), class: "btn btn--primary" %>
      </div>
    </div>
  <% end %>
</div>

<div class="pagination-container">
  <%= paginate @movies %>
</div>
