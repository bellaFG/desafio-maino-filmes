<!DOCTYPE html>
<html lang="<%= I18n.locale %>">
<head>
  <meta charset="UTF-8">
  <title>Maino Filmes</title>
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>

  <!-- Fontes -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- CSS -->
  <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>

  <!-- JavaScript principal -->
  <%= javascript_importmap_tags %>
</head>

<body>
  <header class="header">
    <h1 class="header__logo">
      <%= link_to "Maino Filmes", movies_path, class: "header__link" %>
    </h1>

    <div class="header__center">
      <%= form_with url: movies_path, method: :get, local: true, class: "search-form" do |f| %>
        <%= f.text_field :q, placeholder: t('search.placeholder'), value: params[:q], class: "search-form__input" %>
        <button type="submit" class="btn btn--search"><%= t('search.button') %></button>
      <% end %>
    </div>

    <div class="header__right">
      <% if user_signed_in? %>
        <span><%= t('header.hello') %>, <%= current_user.name.split.first %></span>

        <%# Foto de perfil com fallback %>
        <%= link_to edit_user_registration_path, id: "profile-link", class: "nav__profile" do %>
          <% if current_user.avatar.attached? %>
            <%= image_tag url_for(current_user.avatar), class: "profile-icon", alt: "Foto de Perfil" %>
          <% else %>
            <%= image_tag "default-user.png", class: "profile-icon", alt: "Foto de Perfil PadrÃ£o" %>
          <% end %>
        <% end %>

        <%= button_to t('header.logout'), destroy_user_session_path,
            method: :delete, class: "btn-logout" %>
      <% else %>
        <nav class="nav">
          <%= link_to t('header.login'), new_user_session_path, class: "nav__link" %>
          <%= link_to t('header.register'), new_user_registration_path, class: "nav__link" %>
        </nav>
      <% end %>
    </div>
  </header>

  <% if (controller_name == 'movies' && action_name == 'index') || 
        (controller_name == 'home' && action_name == 'index') %>
    <div class="language-switch">
      <%= link_to "EN", url_for(locale: :en),
          class: "btn btn--lang #{'active' if I18n.locale == :en}" %>
      <%= link_to "PT", url_for(locale: :pt),
          class: "btn btn--lang #{'active' if I18n.locale == :pt}" %>
    </div>
  <% end %>

  <main class="main">
    <% if notice %>
      <div class="notice"><%= notice %></div>
    <% end %>
    <% if alert %>
      <div class="alert"><%= alert %></div>
    <% end %>

    <%= yield %>
  </main>

  <footer class="footer">
    &copy; <%= Time.current.year %> Maino Filmes
  </footer>
</body>
</html>
